http://10.16.35.241:8090/display/RD/RESTful+API#RESTfulAPI


##概念介绍

###概念：

REST（英文：Representational State Transfer，简称REST，表征性状态传输）指的是一组架构约束条件和原则。

符合REST设计风格的Web API称为RESTful API。
REST通俗来讲就是：资源在网络中以某种表现形式进行状态转移，分解开来：

- Resource：资源，即数据。比如users、order等；
- Representational：某种表现形式，比如用JSON、XML、JPEG等；
- State Transfer：状态变化。通过HTTP（GET、POST、PUT、DELETE等）动词实现。

RESTful架构可以看作是**面向资源的架构**（Resource-Oriented Architecture，简称ROA）：资源是有URI来指定。

所谓“上网”，就是与互联网上一系列的“资源”互动，调用它的URI。
对资源的操作包括获取、创建、修改和删除资源，这些操作正好对应HTTP协议提供的GET、POST、PUT、DELETE方法。

通过操作资源的表现形式来操作资源。
具体表现形式，应该在HTTP请求的头信息中用Accept和Content-Type字段指定。
资源的表现形式则是JSON、XML或者HTML等，取决于读者是机器还是人，是消费web服务的客户软件还是web浏览器。当然也可以是任何其他格式。

如何**将API拆分为逻辑上的资源，并且这些资源能通过http被操作**（GET、POST、PUT、DELETE）是RESTful API设计的关键。

###原则：

- 无状态：客户端和服务器之间的交互在请求之间是无状态的。
- 资源：在服务器端，应用程序状态和功能可以分为各种资源。
- 分层：限制整个系统的复杂性，促进底层的独立性，同时保证组件之间的互通性。

###探讨：

- 浏览器友好：API应该是对浏览器有好的，能够很好地融入Web，而不是与Web格格不入（好的RESTful API应该能够使用浏览器+HTML完成所有测试）。
- 资源操作：API中所包含的资源和对资源的操作，应该是只管和容易理解的，并且符合HTTP协议的要求（REST开发又被称作“面向资源的开发”，这说明对资源的抽象，是设计RESTful API核心内容）。
- 松耦合：API应该是松耦合的（**RESTful API的设计包括了三个循序渐进、由低到高的层次：资源抽象、统一接口、超文本驱动**）。
- 通用格式：API中所使用的表述格式应该是常见的通用格式（在RESTful API中，对资源的操作，是通过在服务器端-客户端之间传递资源的表述来间接完成的）。
- 错误处理：使用**HTTP响应状态代码**来表达各种出错情况（HTTP响应状态代码，是HTTP协议这个统一接口中用来表达出错情况的标准机制）。
- 缓存友好：API应该对于**HTTP缓存**是友好的（充分利用好HTTP缓存是RESTful API可松缩性的根本）。

##基本方针

1.规范统一的接口：

规范统一的接口要求任何REST服务必须得提供一个符合其设计的基础规范。其限定规则对客户端和服务端之间的接口进行了定义。对于规范统一的接口有四个知道原则：

- **基于资源**：独立的资源都是在请求中使用URI作为资源的标识符来进行定义的，而且在返回给客户端的响应那里进行了分离。
- 通过接口所呈现的数据来决定对资源进行什么样的操作：当客户端获取到了一个资源的数据呈现，包含一些附带的元数据，它也就有了足够的信息来对服务器上的资源进行定制或者删除操作，前提是它有这样做的权限。
- 具备自我描述性的信息: 每一个消息都包含了一块能精确描述如何对齐进行处理的信息。响应信息也会清晰明确的指出它们是否具备缓存能力。
- 将超媒体作为应用程序状态的引擎: 客户端会通过**消息体内容、查询字符串参数、请求消息头还有请求的URI**来传递状态信息。服务会通过**消息体内容、响应编码以及响应消息头**来先客户端传递状态。

2.客户端-服务端：

客户端和服务端被规则的接口分离开来。
比如，客户端不关心数据存储，数据存储由每个服务端维护，这提高客户端代码的可移植性。
服务端不用操心用户界面或者用户状态，所以可以变得更简单，更具伸缩性。

只要接口不变，服务端和客户端都可以独立的替换或升级。
最重要的事情是有完整的接口——可以给客户端一个在线 RESTful API 文档或者RESTful API模拟调用用以帮助客户端开始连接。

3.无状态的：

URL、查询参数、内容或者头中已经包含了操作请求所需要的各种状态。
URL标识资源，内容包含了资源的状态。
然而，服务端处理之后，适当的状态或部分状态会通过响应头、响应状态、响应内容等回传给客户端。

4.可缓存的：

客户端可以缓存响应，这需要隐式或显式的定义为可缓存的，或者在将来的请求中不阻止客户端重复使用状态，或者允许不太合适的响应数据。

一个管理良好的缓存会排除一些，甚至全部客户端与服务端之间的活动，以提升性能。


5.微服务：

微服务或者分层次系统使得客户端在请求时通常不能够知晓它是直接连接到最终的服务器还是一个中间服务器。

使用负载均衡和一致性缓存的调解服务或API网关，有助于提高系统可扩展性，分层系统也能强化安全策略。

6.按需编码：

服务可以通过传输执行命令进行临时扩展或者实现自定义功能。以使用的编译组件为例，编译组件可能包括：Java applets编译器和用户端的脚步语言（例如JavaScript）的编译器，随需而定。

按需编码是六个约束中唯一一个可选项。

7.版本控制：

你的 API 是怎么给内外的 API 消费者消费的，如果考虑不周，你管理和维护 API 资产将很困难。

在这些方面， 获取 RESTful API 版本控制的思考 这篇文章引起了很大的反响。

版本控制是一份向导十分重要的部分，且更重要的是给跨组织创建一个详尽的政策；如果团队各自采取不同的办法，他们就会处在自治模式之中，在跨组织 API 之间的依赖关系上将变得非常难以维护。

一个版本控制政策应该自顶向下来定义，还要有清晰的指导方针来指导什么时候使用，以及为什么使用你这个版本的 API。在他们认为合适的地方（自定义头，Accept 标头或者是 URI 的一部分），赋予团队灵活性，允许他们实现适合的版本请求。

8.构建块：

如下可能是一个API最重要的几个基础构建块:

- 资源(URI)
- HTTP 方法
- HTTP 消息头
- 查询参数
- 返回编码


###设计指南

- 协议：API与用户的通信协议，总是使用HTTPs协议。
- 域名：API应该部署在专用域名之下，与WEB站点进行区分。例如：https://api.example.com
- 路径：每个一个URI都代表一种资源（resource），所以URI中不能有动词，只能有名词，而且名词应使用复数。例如：https://api.example.com/ymc/v1/orders
- 版本：API应加入版本号，在请求头重加入客户端版本号。例如：https://api.example.com/v1
- 动词：对资源的操作的具体类型，由HTTP动词表示。
 - **注意HTTP仅仅是REST的一种实现，不是标准**。
- 过滤：如果记录数量很多服务器不可能都将他们返回给用户。API应该提供参数，过来返回结果。下面是一些常见的参数：
  - ?limit=10：指定返回记录的数据
  - ?offset=10：指定返回记录的开始位置
  - ?pageIndex=1&pageSize=10：指定第几页，以及每页的记录数
  - ?sortby=name&order=asc：指定返回结果按照哪个属性排序，以及排序顺序。
  - ?type=1：指定筛选条件


##幂等设计 ？？

在HTTP/1.1规范中幂等性的定义是：

>Methods can also have the property of "idempotence" in that (aside from error or expiration issues) the side-effects of N > 0 identical requests is the same as for a single request.


在编程中一个幂等的操作的特点是其任意执行多次所产生的影响均与一次执行的影响相同。幂等函数，或幂等方法，是指可以使用相同的参数重复执行，并能获得相同结果的函数。这些函数不会影响系统状态，也不用担心重复执行会对系统造成改变。例如，“getUserName()”函数就是一个幂等函数，更复杂的操作幂等保证是利用唯一交易号（流水号）实现。